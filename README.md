## 🚀 DiscordへのYouTube動画通知システム導入ガイド（GAS利用）

このガイドでは、Google Apps Script（GAS）を利用して、特定のYouTubeチャンネルに新しい動画が投稿された際に、Discordサーバーへ自動で通知を送るシステムの設定方法を説明します。

-----

## 1\. 📂 GASプロジェクトの準備

### 1-1. ファイルのインポートと保存

まず、システムを構成する2つのコードファイル（`通知チャンネル`と`discordsystem`）の中身を、ご自身のGoogle Apps Script（GAS）環境にコピーして、それぞれ**別々のGASプロジェクト**として保存します。

| ファイル名 | GASでの保存名 | 役割 |
| :--- | :--- | :--- |
| **`通知チャンネル`** | （任意の名前） | メインの処理（YouTubeデータの取得、Discordへの投稿処理）を行うファイル |
| **`discordsystem`** | （任意の名前） | 通知時間の管理など、補助的な処理を行うファイル |

### 1-2. ライブラリの設定（2つのファイルを連携させる）

\*\*`通知チャンネル`**ファイルから**`discordsystem`\*\*ファイルの機能を使えるように連携させます。

1.  \*\*`discordsystem`**ファイルを開き、左側メニューの**⚙️「プロジェクトの設定」**から**「スクリプト ID」\*\*をコピーします。
2.  \*\*`通知チャンネル`**ファイルを開き、左側メニューの**📚「ライブラリ」\*\*を開きます。
3.  コピーした\*\*「スクリプト ID」\*\*を貼り付けます。
4.  **「識別子」**（ライブラリの名前）は\*\*`discordsystem`\*\*として保存してください。

-----

## 2\. 🔗 各種URLとAPIの設定

### 2-1. Discord Webhook URLの取得

Discordの\*\*Webhook（ウェブフック）\*\*は、外部サービスからDiscordチャンネルにメッセージを送信するための専用URLです。

1.  Discordサーバーの\*\*「サーバー設定」\*\*を開きます。
2.  \*\*「連携サービス」**を選択し、**「ウェブフック」\*\*をクリックします。
3.  \*\*「新しいウェブフック」\*\*を作成し、名前と投稿先のチャンネルを設定します。
4.  \*\*「ウェブフックURLをコピー」\*\*をクリックして、URLを手に入れます。

### 2-2. `通知チャンネル`ファイルの編集

取得したWebhook URLと通知したいYouTubeチャンネルの情報を\*\*`通知チャンネル`\*\*ファイル内の`postchannel`変数に設定します。

```javascript
// 通知チャンネル (15行目付近)
var postchannel = {
  webhooks: 'ここにコピーしたDiscord Webhook URLを貼り付けます', // webhookのURL
  icon : '', // 通知メッセージのアイコン画像URL (任意。不要ならコメントアウトまたは空欄)
  channel: 'ここに通知したいYouTubeチャンネルのIDを貼り付けます' // youtubeチャンネルのID
}
```

### 2-3. YouTube Data API の有効化

YouTubeの情報を取得するために、Googleのサービスである**YouTube Data API**をGASプロジェクトで使えるようにします。

1.  \*\*`通知チャンネル`**ファイルを開き、左側メニューの**➕「サービス」\*\*の横にある「サービスを追加」をクリックします。
2.  検索欄に\*\*`YouTube Data API`**を入力して選択し、バージョン**`v3`**であることを確認して**「追加」\*\*をクリックします。

-----

## 3\. 🆔 YouTubeチャンネルIDの調べ方

YouTubeチャンネルIDは、そのチャンネルを特定するための固有のIDです。

1.  通知したいYouTubeチャンネルにアクセスします。
2.  **「このチャンネルの詳細」**（または概要欄など）をクリックします。
3.  \*\*「チャンネルを共有」**をクリックし、**「チャンネルIDをコピー」\*\*でIDを取得できます。

> 💡 **チャンネルアイコンの取得（任意）:**
> チャンネルのアイコン画像を右クリックし、\*\*「画像アドレスをコピー」\*\*でURLを取得すると、`icon`として設定できます。

-----

## 4\. ✅ テスト実行

設定が正しくできているか確認するために、一度コードを実行してみましょう。

\*\*`通知チャンネル`\*\*ファイルの該当箇所を編集し、テスト用の設定（`=== 1`）にします。

```javascript
// 通知チャンネル (42行目付近)

// 本番環境 (通常はこちら: 0)
// if (discordsystem.nowdata(posttime) === 0){ 
// ...

// 実行テスト (テスト時のみ: 1)
if (discordsystem.nowdata(posttime) === 1){ // <-- ここを1に変更して実行
    var url = `${youtubeurl}${data.id.videoId}`;
    // var icon = data.snippet.thumbnails.default.url;
    console.log(url);
```

1.  コード上部の▶️\*\*「実行」\*\*ボタンをクリックします。
2.  **最初の実行時**には、Googleアカウントへの\*\*承認（アクセス許可）\*\*を求められます。画面の指示に従い、アクセスを許可してください（ご自身のGoogleアカウントとYouTube APIの連携に必要な処理です）。
3.  実行後、Discordサーバーにテスト通知が届けば成功です。
4.  テスト後は、元の設定（`=== 0`）に戻しておきましょう。

-----

## 5\. ⏰ 自動実行（トリガー）の設定

システムを定期的に自動で実行するために**トリガー**を設定します。

1.  \*\*`通知チャンネル`**ファイルを開き、左側メニューの**⏰「トリガー」\*\*を開きます。
2.  右下の\*\*「トリガーを追加」\*\*をクリックします。
3.  以下の設定を選択し、保存します。
      * **実行する関数:** `getvideoset`
      * **時間ベースのトリガーのタイプを選択:** **`分タイマーベース`**
      * **時間の間隔を選択（分）:** **`15分`**

### 💡 トリガーを15分にする理由

YouTube Data APIには、1日あたり**10,000ユニット**のクォータ（利用制限）があります。動画の更新をチェックする処理は、**1回あたり100クォータ**を消費します。

10,000クォータ / 100クォータ = 100回
24時間 × 60分 = 1440分
1440分 / 100回 $\approx$ **14.4分**

そのため、クォータを使い切らないように、**15分に1回**の実行に設定するのがおすすめです。

-----

## 6\. ⚙️ その他の機能（ライブ配信の通知）

初期設定では**動画**の投稿をチェックしますが、**ライブ配信**の開始を通知するように変更も可能です。

\*\*`通知チャンネル`\*\*ファイルの`getYoutubeData`関数の引数を変更します。

```javascript
// 通知チャンネル (29行目付近)

// 動画の場合（初期設定）
var datas = await getYoutubeData(postchannel.channel,eventType="none"); 

// 配信（ライブ）の場合
// var datas = await getYoutubeData(postchannel.channel,eventType="live"); 
```

> 📌 **備考（上級者向け）：**
> 動画通知用とライブ配信通知用で、それぞれ\*\*別のGASファイル（プロジェクト）\*\*を用意し、両方に15分タイマーのトリガーを設定することで、クォータの制限を気にせずに両方の通知を行うことができます。
